import { useContext } from "react";
import { AppContext } from "@/store/app";
import { useState, useEffect } from "react";
import { useParams } from "react-router-dom";
import { BiomarkerCategory , diagnosis } from "@/types";
import { Application } from "@/api";
import { useMemo } from "react";
import { faker } from "@faker-js/faker";
export function useApp() {
  const context = useContext(AppContext);
  if (context === undefined) throw new Error("AuthContext was used outside of the AuthContextProvider");
  return context;
}
export const useBiomarkers = () => {
  const { id } = useParams<{ id: string }>();
  const [biomarkers, setBiomarkers] = useState<BiomarkerCategory[]>([]);

  useEffect(() => {
    const fetchBiomarkers = async () => {
      if (id) {
        try {
          const response = await Application.getBiomarkersByPatientId(Number(id));
          setBiomarkers(response.data);
        } catch (error) {
          console.error("Failed to fetch biomarkers:", error);
        }
      }
    };

    fetchBiomarkers();
  }, [id]);

  return biomarkers;
};
export const useDiagnosis = () => {
  const { id } = useParams<{ id: string }>();
  const { getPatientById } = useContext(AppContext);
  const [diagnosis, setDiagnosis] = useState<diagnosis[]>([]);

  useEffect(() => {
    if (id) {
      const patient = getPatientById(Number(id));
      if (patient) {
        setDiagnosis(patient.diagnosis);
      }
    }
  }, [id, getPatientById]);

  return diagnosis;
};


export const useRandom = () => {
  const randomColor = useMemo(() => {
    return () => `#${Math.floor(Math.random() * 16777215).toString(16)}`;
  }, []);

  return { faker, randomColor };
};